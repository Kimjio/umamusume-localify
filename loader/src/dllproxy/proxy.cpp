#include <stdinclude.hpp>

extern "C"
{
	void* ImmCallImeConsoleIME_Original = nullptr;
	void* ImmIMPGetIMEA_Original = nullptr;
	void* ImmIMPGetIMEW_Original = nullptr;
	void* ImmIMPQueryIMEA_Original = nullptr;
	void* ImmIMPQueryIMEW_Original = nullptr;
	void* ImmIMPSetIMEA_Original = nullptr;
	void* ImmIMPSetIMEW_Original = nullptr;
	void* ImmPutImeMenuItemsIntoMappedFile_Original = nullptr;
	void* ImmRegisterClient_Original = nullptr;
	void* ImmSendIMEMessageExA_Original = nullptr;
	void* ImmSendIMEMessageExW_Original = nullptr;
	void* ImmSetActiveContextConsoleIME_Original = nullptr;
	void* ImmSystemHandler_Original = nullptr;
	void* ImmWINNLSEnableIME_Original = nullptr;
	void* ImmWINNLSGetEnableStatus_Original = nullptr;
	void* ImmWINNLSGetIMEHotkey_Original = nullptr;
	void* CtfImmAppCompatEnableIMEonProtectedCode_Original = nullptr;
	void* CtfImmCoUninitialize_Original = nullptr;
	void* CtfImmDispatchDefImeMessage_Original = nullptr;
	void* CtfImmEnterCoInitCountSkipMode_Original = nullptr;
	void* CtfImmGenerateMessage_Original = nullptr;
	void* CtfImmGetCompatibleKeyboardLayout_Original = nullptr;
	void* CtfImmGetGlobalIMEStatus_Original = nullptr;
	void* CtfImmGetGuidAtom_Original = nullptr;
	void* CtfImmGetIMEFileName_Original = nullptr;
	void* CtfImmGetTMAEFlags_Original = nullptr;
	void* CtfImmHideToolbarWnd_Original = nullptr;
	void* CtfImmIsCiceroEnabled_Original = nullptr;
	void* CtfImmIsCiceroStartedInThread_Original = nullptr;
	void* CtfImmIsComStartedInThread_Original = nullptr;
	void* CtfImmIsGuidMapEnable_Original = nullptr;
	void* CtfImmIsTextFrameServiceDisabled_Original = nullptr;
	void* CtfImmLastEnabledWndDestroy_Original = nullptr;
	void* CtfImmLeaveCoInitCountSkipMode_Original = nullptr;
	void* CtfImmNotify_Original = nullptr;
	void* CtfImmRestoreToolbarWnd_Original = nullptr;
	void* CtfImmSetAppCompatFlags_Original = nullptr;
	void* CtfImmSetCiceroStartInThread_Original = nullptr;
	void* CtfImmSetDefaultRemoteKeyboardLayout_Original = nullptr;
	void* CtfImmTIMActivate_Original = nullptr;
	void* GetKeyboardLayoutCP_Original = nullptr;
	void* ImmActivateLayout_Original = nullptr;
	void* ImmAssociateContext_Original = nullptr;
	void* ImmAssociateContextEx_Original = nullptr;
	void* ImmConfigureIMEA_Original = nullptr;
	void* ImmConfigureIMEW_Original = nullptr;
	void* ImmCreateContext_Original = nullptr;
	void* ImmCreateIMCC_Original = nullptr;
	void* ImmCreateSoftKeyboard_Original = nullptr;
	void* ImmDestroyContext_Original = nullptr;
	void* ImmDestroyIMCC_Original = nullptr;
	void* ImmDestroySoftKeyboard_Original = nullptr;
	void* ImmDisableIME_Original = nullptr;
	void* ImmDisableLegacyIME_Original = nullptr;
	void* ImmDisableTextFrameService_Original = nullptr;
	void* ImmEnumInputContext_Original = nullptr;
	void* ImmEnumRegisterWordA_Original = nullptr;
	void* ImmEnumRegisterWordW_Original = nullptr;
	void* ImmEscapeA_Original = nullptr;
	void* ImmEscapeW_Original = nullptr;
	void* ImmFreeLayout_Original = nullptr;
	void* ImmGenerateMessage_Original = nullptr;
	void* ImmGetAppCompatFlags_Original = nullptr;
	void* ImmGetCandidateListA_Original = nullptr;
	void* ImmGetCandidateListCountA_Original = nullptr;
	void* ImmGetCandidateListCountW_Original = nullptr;
	void* ImmGetCandidateListW_Original = nullptr;
	void* ImmGetCandidateWindow_Original = nullptr;
	void* ImmGetCompositionFontA_Original = nullptr;
	void* ImmGetCompositionFontW_Original = nullptr;
	void* ImmGetCompositionStringA_Original = nullptr;
	void* ImmGetCompositionStringW_Original = nullptr;
	void* ImmGetCompositionWindow_Original = nullptr;
	void* ImmGetContext_Original = nullptr;
	void* ImmGetConversionListA_Original = nullptr;
	void* ImmGetConversionListW_Original = nullptr;
	void* ImmGetConversionStatus_Original = nullptr;
	void* ImmGetDefaultIMEWnd_Original = nullptr;
	void* ImmGetDescriptionA_Original = nullptr;
	void* ImmGetDescriptionW_Original = nullptr;
	void* ImmGetGuideLineA_Original = nullptr;
	void* ImmGetGuideLineW_Original = nullptr;
	void* ImmGetHotKey_Original = nullptr;
	void* ImmGetIMCCLockCount_Original = nullptr;
	void* ImmGetIMCCSize_Original = nullptr;
	void* ImmGetIMCLockCount_Original = nullptr;
	void* ImmGetIMEFileNameA_Original = nullptr;
	void* ImmGetIMEFileNameW_Original = nullptr;
	void* ImmGetImeInfoEx_Original = nullptr;
	void* ImmGetImeMenuItemsA_Original = nullptr;
	void* ImmGetImeMenuItemsW_Original = nullptr;
	void* ImmGetOpenStatus_Original = nullptr;
	void* ImmGetProperty_Original = nullptr;
	void* ImmGetRegisterWordStyleA_Original = nullptr;
	void* ImmGetRegisterWordStyleW_Original = nullptr;
	void* ImmGetStatusWindowPos_Original = nullptr;
	void* ImmGetVirtualKey_Original = nullptr;
	void* ImmInstallIMEA_Original = nullptr;
	void* ImmInstallIMEW_Original = nullptr;
	void* ImmIsIME_Original = nullptr;
	void* ImmIsUIMessageA_Original = nullptr;
	void* ImmIsUIMessageW_Original = nullptr;
	void* ImmLoadIME_Original = nullptr;
	void* ImmLoadLayout_Original = nullptr;
	void* ImmLockClientImc_Original = nullptr;
	void* ImmLockIMC_Original = nullptr;
	void* ImmLockIMCC_Original = nullptr;
	void* ImmLockImeDpi_Original = nullptr;
	void* ImmNotifyIME_Original = nullptr;
	void* ImmProcessKey_Original = nullptr;
	void* ImmReSizeIMCC_Original = nullptr;
	void* ImmRegisterWordA_Original = nullptr;
	void* ImmRegisterWordW_Original = nullptr;
	void* ImmReleaseContext_Original = nullptr;
	void* ImmRequestMessageA_Original = nullptr;
	void* ImmRequestMessageW_Original = nullptr;
	void* ImmSetActiveContext_Original = nullptr;
	void* ImmSetCandidateWindow_Original = nullptr;
	void* ImmSetCompositionFontA_Original = nullptr;
	void* ImmSetCompositionFontW_Original = nullptr;
	void* ImmSetCompositionStringA_Original = nullptr;
	void* ImmSetCompositionStringW_Original = nullptr;
	void* ImmSetCompositionWindow_Original = nullptr;
	void* ImmSetConversionStatus_Original = nullptr;
	void* ImmSetHotKey_Original = nullptr;
	void* ImmSetOpenStatus_Original = nullptr;
	void* ImmSetStatusWindowPos_Original = nullptr;
	void* ImmShowSoftKeyboard_Original = nullptr;
	void* ImmSimulateHotKey_Original = nullptr;
	void* ImmTranslateMessage_Original = nullptr;
	void* ImmUnlockClientImc_Original = nullptr;
	void* ImmUnlockIMC_Original = nullptr;
	void* ImmUnlockIMCC_Original = nullptr;
	void* ImmUnlockImeDpi_Original = nullptr;
	void* ImmUnregisterWordA_Original = nullptr;
	void* ImmUnregisterWordW_Original = nullptr;
}

using namespace std;

namespace hook
{
	proxy::proxy()
	{
		std::wstring dll_path;
		dll_path.resize(MAX_PATH);
		dll_path.resize(GetSystemDirectoryW(dll_path.data(), MAX_PATH));

		auto original_dll = LoadLibraryW(L"imm32.dll");
		if (original_dll == nullptr)
		{
			return;
		}

		ImmCallImeConsoleIME_Original = GetProcAddress(original_dll, "ImmCallImeConsoleIME");
		ImmIMPGetIMEA_Original = GetProcAddress(original_dll, "ImmIMPGetIMEA");
		ImmIMPGetIMEW_Original = GetProcAddress(original_dll, "ImmIMPGetIMEW");
		ImmIMPQueryIMEA_Original = GetProcAddress(original_dll, "ImmIMPQueryIMEA");
		ImmIMPQueryIMEW_Original = GetProcAddress(original_dll, "ImmIMPQueryIMEW");
		ImmIMPSetIMEA_Original = GetProcAddress(original_dll, "ImmIMPSetIMEA");
		ImmIMPSetIMEW_Original = GetProcAddress(original_dll, "ImmIMPSetIMEW");
		ImmPutImeMenuItemsIntoMappedFile_Original = GetProcAddress(original_dll, "ImmPutImeMenuItemsIntoMappedFile");
		ImmRegisterClient_Original = GetProcAddress(original_dll, "ImmRegisterClient");
		ImmSendIMEMessageExA_Original = GetProcAddress(original_dll, "ImmSendIMEMessageExA");
		ImmSendIMEMessageExW_Original = GetProcAddress(original_dll, "ImmSendIMEMessageExW");
		ImmSetActiveContextConsoleIME_Original = GetProcAddress(original_dll, "ImmSetActiveContextConsoleIME");
		ImmSystemHandler_Original = GetProcAddress(original_dll, "ImmSystemHandler");
		ImmWINNLSEnableIME_Original = GetProcAddress(original_dll, "ImmWINNLSEnableIME");
		ImmWINNLSGetEnableStatus_Original = GetProcAddress(original_dll, "ImmWINNLSGetEnableStatus");
		ImmWINNLSGetIMEHotkey_Original = GetProcAddress(original_dll, "ImmWINNLSGetIMEHotkey");
		CtfImmAppCompatEnableIMEonProtectedCode_Original = GetProcAddress(original_dll, "CtfImmAppCompatEnableIMEonProtectedCode");
		CtfImmCoUninitialize_Original = GetProcAddress(original_dll, "CtfImmCoUninitialize");
		CtfImmDispatchDefImeMessage_Original = GetProcAddress(original_dll, "CtfImmDispatchDefImeMessage");
		CtfImmEnterCoInitCountSkipMode_Original = GetProcAddress(original_dll, "CtfImmEnterCoInitCountSkipMode");
		CtfImmGenerateMessage_Original = GetProcAddress(original_dll, "CtfImmGenerateMessage");
		CtfImmGetCompatibleKeyboardLayout_Original = GetProcAddress(original_dll, "CtfImmGetCompatibleKeyboardLayout");
		CtfImmGetGlobalIMEStatus_Original = GetProcAddress(original_dll, "CtfImmGetGlobalIMEStatus");
		CtfImmGetGuidAtom_Original = GetProcAddress(original_dll, "CtfImmGetGuidAtom");
		CtfImmGetIMEFileName_Original = GetProcAddress(original_dll, "CtfImmGetIMEFileName");
		CtfImmGetTMAEFlags_Original = GetProcAddress(original_dll, "CtfImmGetTMAEFlags");
		CtfImmHideToolbarWnd_Original = GetProcAddress(original_dll, "CtfImmHideToolbarWnd");
		CtfImmIsCiceroEnabled_Original = GetProcAddress(original_dll, "CtfImmIsCiceroEnabled");
		CtfImmIsCiceroStartedInThread_Original = GetProcAddress(original_dll, "CtfImmIsCiceroStartedInThread");
		CtfImmIsComStartedInThread_Original = GetProcAddress(original_dll, "CtfImmIsComStartedInThread");
		CtfImmIsGuidMapEnable_Original = GetProcAddress(original_dll, "CtfImmIsGuidMapEnable");
		CtfImmIsTextFrameServiceDisabled_Original = GetProcAddress(original_dll, "CtfImmIsTextFrameServiceDisabled");
		CtfImmLastEnabledWndDestroy_Original = GetProcAddress(original_dll, "CtfImmLastEnabledWndDestroy");
		CtfImmLeaveCoInitCountSkipMode_Original = GetProcAddress(original_dll, "CtfImmLeaveCoInitCountSkipMode");
		CtfImmNotify_Original = GetProcAddress(original_dll, "CtfImmNotify");
		CtfImmRestoreToolbarWnd_Original = GetProcAddress(original_dll, "CtfImmRestoreToolbarWnd");
		CtfImmSetAppCompatFlags_Original = GetProcAddress(original_dll, "CtfImmSetAppCompatFlags");
		CtfImmSetCiceroStartInThread_Original = GetProcAddress(original_dll, "CtfImmSetCiceroStartInThread");
		CtfImmSetDefaultRemoteKeyboardLayout_Original = GetProcAddress(original_dll, "CtfImmSetDefaultRemoteKeyboardLayout");
		CtfImmTIMActivate_Original = GetProcAddress(original_dll, "CtfImmTIMActivate");
		GetKeyboardLayoutCP_Original = GetProcAddress(original_dll, "GetKeyboardLayoutCP");
		ImmActivateLayout_Original = GetProcAddress(original_dll, "ImmActivateLayout");
		ImmAssociateContext_Original = GetProcAddress(original_dll, "ImmAssociateContext");
		ImmAssociateContextEx_Original = GetProcAddress(original_dll, "ImmAssociateContextEx");
		ImmConfigureIMEA_Original = GetProcAddress(original_dll, "ImmConfigureIMEA");
		ImmConfigureIMEW_Original = GetProcAddress(original_dll, "ImmConfigureIMEW");
		ImmCreateContext_Original = GetProcAddress(original_dll, "ImmCreateContext");
		ImmCreateIMCC_Original = GetProcAddress(original_dll, "ImmCreateIMCC");
		ImmCreateSoftKeyboard_Original = GetProcAddress(original_dll, "ImmCreateSoftKeyboard");
		ImmDestroyContext_Original = GetProcAddress(original_dll, "ImmDestroyContext");
		ImmDestroyIMCC_Original = GetProcAddress(original_dll, "ImmDestroyIMCC");
		ImmDestroySoftKeyboard_Original = GetProcAddress(original_dll, "ImmDestroySoftKeyboard");
		ImmDisableIME_Original = GetProcAddress(original_dll, "ImmDisableIME");
		ImmDisableLegacyIME_Original = GetProcAddress(original_dll, "ImmDisableLegacyIME");
		ImmDisableTextFrameService_Original = GetProcAddress(original_dll, "ImmDisableTextFrameService");
		ImmEnumInputContext_Original = GetProcAddress(original_dll, "ImmEnumInputContext");
		ImmEnumRegisterWordA_Original = GetProcAddress(original_dll, "ImmEnumRegisterWordA");
		ImmEnumRegisterWordW_Original = GetProcAddress(original_dll, "ImmEnumRegisterWordW");
		ImmEscapeA_Original = GetProcAddress(original_dll, "ImmEscapeA");
		ImmEscapeW_Original = GetProcAddress(original_dll, "ImmEscapeW");
		ImmFreeLayout_Original = GetProcAddress(original_dll, "ImmFreeLayout");
		ImmGenerateMessage_Original = GetProcAddress(original_dll, "ImmGenerateMessage");
		ImmGetAppCompatFlags_Original = GetProcAddress(original_dll, "ImmGetAppCompatFlags");
		ImmGetCandidateListA_Original = GetProcAddress(original_dll, "ImmGetCandidateListA");
		ImmGetCandidateListCountA_Original = GetProcAddress(original_dll, "ImmGetCandidateListCountA");
		ImmGetCandidateListCountW_Original = GetProcAddress(original_dll, "ImmGetCandidateListCountW");
		ImmGetCandidateListW_Original = GetProcAddress(original_dll, "ImmGetCandidateListW");
		ImmGetCandidateWindow_Original = GetProcAddress(original_dll, "ImmGetCandidateWindow");
		ImmGetCompositionFontA_Original = GetProcAddress(original_dll, "ImmGetCompositionFontA");
		ImmGetCompositionFontW_Original = GetProcAddress(original_dll, "ImmGetCompositionFontW");
		ImmGetCompositionStringA_Original = GetProcAddress(original_dll, "ImmGetCompositionStringA");
		ImmGetCompositionStringW_Original = GetProcAddress(original_dll, "ImmGetCompositionStringW");
		ImmGetCompositionWindow_Original = GetProcAddress(original_dll, "ImmGetCompositionWindow");
		ImmGetContext_Original = GetProcAddress(original_dll, "ImmGetContext");
		ImmGetConversionListA_Original = GetProcAddress(original_dll, "ImmGetConversionListA");
		ImmGetConversionListW_Original = GetProcAddress(original_dll, "ImmGetConversionListW");
		ImmGetConversionStatus_Original = GetProcAddress(original_dll, "ImmGetConversionStatus");
		ImmGetDefaultIMEWnd_Original = GetProcAddress(original_dll, "ImmGetDefaultIMEWnd");
		ImmGetDescriptionA_Original = GetProcAddress(original_dll, "ImmGetDescriptionA");
		ImmGetDescriptionW_Original = GetProcAddress(original_dll, "ImmGetDescriptionW");
		ImmGetGuideLineA_Original = GetProcAddress(original_dll, "ImmGetGuideLineA");
		ImmGetGuideLineW_Original = GetProcAddress(original_dll, "ImmGetGuideLineW");
		ImmGetHotKey_Original = GetProcAddress(original_dll, "ImmGetHotKey");
		ImmGetIMCCLockCount_Original = GetProcAddress(original_dll, "ImmGetIMCCLockCount");
		ImmGetIMCCSize_Original = GetProcAddress(original_dll, "ImmGetIMCCSize");
		ImmGetIMCLockCount_Original = GetProcAddress(original_dll, "ImmGetIMCLockCount");
		ImmGetIMEFileNameA_Original = GetProcAddress(original_dll, "ImmGetIMEFileNameA");
		ImmGetIMEFileNameW_Original = GetProcAddress(original_dll, "ImmGetIMEFileNameW");
		ImmGetImeInfoEx_Original = GetProcAddress(original_dll, "ImmGetImeInfoEx");
		ImmGetImeMenuItemsA_Original = GetProcAddress(original_dll, "ImmGetImeMenuItemsA");
		ImmGetImeMenuItemsW_Original = GetProcAddress(original_dll, "ImmGetImeMenuItemsW");
		ImmGetOpenStatus_Original = GetProcAddress(original_dll, "ImmGetOpenStatus");
		ImmGetProperty_Original = GetProcAddress(original_dll, "ImmGetProperty");
		ImmGetRegisterWordStyleA_Original = GetProcAddress(original_dll, "ImmGetRegisterWordStyleA");
		ImmGetRegisterWordStyleW_Original = GetProcAddress(original_dll, "ImmGetRegisterWordStyleW");
		ImmGetStatusWindowPos_Original = GetProcAddress(original_dll, "ImmGetStatusWindowPos");
		ImmGetVirtualKey_Original = GetProcAddress(original_dll, "ImmGetVirtualKey");
		ImmInstallIMEA_Original = GetProcAddress(original_dll, "ImmInstallIMEA");
		ImmInstallIMEW_Original = GetProcAddress(original_dll, "ImmInstallIMEW");
		ImmIsIME_Original = GetProcAddress(original_dll, "ImmIsIME");
		ImmIsUIMessageA_Original = GetProcAddress(original_dll, "ImmIsUIMessageA");
		ImmIsUIMessageW_Original = GetProcAddress(original_dll, "ImmIsUIMessageW");
		ImmLoadIME_Original = GetProcAddress(original_dll, "ImmLoadIME");
		ImmLoadLayout_Original = GetProcAddress(original_dll, "ImmLoadLayout");
		ImmLockClientImc_Original = GetProcAddress(original_dll, "ImmLockClientImc");
		ImmLockIMC_Original = GetProcAddress(original_dll, "ImmLockIMC");
		ImmLockIMCC_Original = GetProcAddress(original_dll, "ImmLockIMCC");
		ImmLockImeDpi_Original = GetProcAddress(original_dll, "ImmLockImeDpi");
		ImmNotifyIME_Original = GetProcAddress(original_dll, "ImmNotifyIME");
		ImmProcessKey_Original = GetProcAddress(original_dll, "ImmProcessKey");
		ImmReSizeIMCC_Original = GetProcAddress(original_dll, "ImmReSizeIMCC");
		ImmRegisterWordA_Original = GetProcAddress(original_dll, "ImmRegisterWordA");
		ImmRegisterWordW_Original = GetProcAddress(original_dll, "ImmRegisterWordW");
		ImmReleaseContext_Original = GetProcAddress(original_dll, "ImmReleaseContext");
		ImmRequestMessageA_Original = GetProcAddress(original_dll, "ImmRequestMessageA");
		ImmRequestMessageW_Original = GetProcAddress(original_dll, "ImmRequestMessageW");
		ImmSetActiveContext_Original = GetProcAddress(original_dll, "ImmSetActiveContext");
		ImmSetCandidateWindow_Original = GetProcAddress(original_dll, "ImmSetCandidateWindow");
		ImmSetCompositionFontA_Original = GetProcAddress(original_dll, "ImmSetCompositionFontA");
		ImmSetCompositionFontW_Original = GetProcAddress(original_dll, "ImmSetCompositionFontW");
		ImmSetCompositionStringA_Original = GetProcAddress(original_dll, "ImmSetCompositionStringA");
		ImmSetCompositionStringW_Original = GetProcAddress(original_dll, "ImmSetCompositionStringW");
		ImmSetCompositionWindow_Original = GetProcAddress(original_dll, "ImmSetCompositionWindow");
		ImmSetConversionStatus_Original = GetProcAddress(original_dll, "ImmSetConversionStatus");
		ImmSetHotKey_Original = GetProcAddress(original_dll, "ImmSetHotKey");
		ImmSetOpenStatus_Original = GetProcAddress(original_dll, "ImmSetOpenStatus");
		ImmSetStatusWindowPos_Original = GetProcAddress(original_dll, "ImmSetStatusWindowPos");
		ImmShowSoftKeyboard_Original = GetProcAddress(original_dll, "ImmShowSoftKeyboard");
		ImmSimulateHotKey_Original = GetProcAddress(original_dll, "ImmSimulateHotKey");
		ImmTranslateMessage_Original = GetProcAddress(original_dll, "ImmTranslateMessage");
		ImmUnlockClientImc_Original = GetProcAddress(original_dll, "ImmUnlockClientImc");
		ImmUnlockIMC_Original = GetProcAddress(original_dll, "ImmUnlockIMC");
		ImmUnlockIMCC_Original = GetProcAddress(original_dll, "ImmUnlockIMCC");
		ImmUnlockImeDpi_Original = GetProcAddress(original_dll, "ImmUnlockImeDpi");
		ImmUnregisterWordA_Original = GetProcAddress(original_dll, "ImmUnregisterWordA");
		ImmUnregisterWordW_Original = GetProcAddress(original_dll, "ImmUnregisterWordW");
	}
}
